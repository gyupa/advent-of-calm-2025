{
  "$schema": "https://calm.finos.org/release/1.1/meta/calm.json",
  "adrs": [
    "docs/adr/0001-use-message-queue-for-async-processing.md",
    "docs/adr/0002-use-oauth2-for-api-authentication.md"
  ],
  "unique-id": "ecommerce-order-platform",
  "name": "E-Commerce Order Processing Platform",
  "description": "E-commerce order processing platform",
  "metadata": {
    "owner": "Gyula",
    "version": "1.0.0",
    "created": "2025-12-15",
    "description": "Microservices-based e-commerce platform for order processing, inventory management, and payments",
    "tags": ["ecommerce", "microservices", "orders"]
  },
  "controls": {
    "security": {
      "description": "Data encryption and secure communication requirements",
      "requirements": [
        {
          "requirement-url": "https://internal-policy.example.com/security/encryption-at-rest",
          "config": {
            "algorithm": "AES-256",
            "scope": "all-data-stores"
          }
        },
        {
          "requirement-url": "https://internal-policy.example.com/security/tls-1-3-minimum",
          "config-url": "https://configs.example.com/security/tls-config.yaml"
        }
      ]
    },
    "performance": {
      "description": "System-wide performance and scalability requirements",
      "requirements": [
        {
          "requirement-url": "https://internal-policy.example.com/performance/response-time-sla",
          "config": {
            "p99-latency-ms": 200,
            "p95-latency-ms": 100
          }
        },
        {
          "requirement-url": "https://internal-policy.example.com/performance/availability-target",
          "config-url": "https://configs.example.com/infra/ha-config.yaml"
        }
      ]
    },
    "high-availability": {
      "description": "System-wide high availability and uptime requirements",
      "requirements": [
        {
          "requirement-url": "https://internal-policy.example.com/resilience/ha-99-9-uptime",
          "config": {
            "uptime-percentage": 99.9,
            "max-downtime-minutes": 43.2
          }
        }
      ]
    }
  },
  "flows": [
    {
      "unique-id": "order-processing-flow",
      "name": "Customer Order Processing",
      "description": "End-to-end flow from customer placing an order to payment confirmation",
      "transitions": [
        {
          "relationship-unique-id": "customer-interacts-load-balancer",
          "sequence-number": 1,
          "description": "Customer submits order via web interface",
          "direction": "source-to-destination"
        },
        {
          "relationship-unique-id": "api-gateway-1-connects-order-service",
          "sequence-number": 2,
          "description": "API Gateway routes order to Order Service",
          "direction": "source-to-destination"
        },
        {
          "relationship-unique-id": "order-service-publishes-order-queue",
          "sequence-number": 3,
          "description": "Order Service publishes order to queue for async payment processing",
          "direction": "source-to-destination"
        }
      ]
    },
    {
      "unique-id": "inventory-check-flow",
      "name": "Inventory Stock Check",
      "description": "Admin checks and updates inventory stock levels",
      "transitions": [
        {
          "relationship-unique-id": "admin-interacts-load-balancer",
          "sequence-number": 1,
          "description": "Admin requests inventory status",
          "direction": "source-to-destination"
        },
        {
          "relationship-unique-id": "api-gateway-1-connects-inventory-service",
          "sequence-number": 2,
          "description": "Route to inventory service",
          "direction": "source-to-destination"
        },
        {
          "relationship-unique-id": "inventory-service-connects-inventory-database",
          "sequence-number": 3,
          "description": "Query current stock levels",
          "direction": "source-to-destination"
        },
        {
          "relationship-unique-id": "inventory-service-connects-inventory-database",
          "sequence-number": 4,
          "description": "Return stock data",
          "direction": "destination-to-source"
        },
        {
          "relationship-unique-id": "api-gateway-1-connects-inventory-service",
          "sequence-number": 5,
          "description": "Return inventory report",
          "direction": "destination-to-source"
        }
      ]
    }
  ],
  "nodes": [
    {
      "unique-id": "customer",
      "node-type": "actor",
      "name": "Customer",
      "description": "End customer using the e-commerce platform to browse and purchase products"
    },
    {
      "unique-id": "admin",
      "node-type": "actor",
      "name": "Admin",
      "description": "Administrator managing orders, inventory, and platform operations"
    },
    {
      "unique-id": "api-gateway-1",
      "node-type": "service",
      "name": "API Gateway 1",
      "description": "Central entry point for all client requests, providing routing, rate limiting, and request validation",
      "metadata": {
        "tech-owner": "Platform Team",
        "repository": "https://github.com/company/api-gateway",
        "deployment-type": "container",
        "sla-tier": "tier-1"
      },
      "interfaces": [
        {
          "unique-id": "api-gateway-1-https",
          "protocol": "HTTPS",
          "host": "api.ecommerce.example.com",
          "port": 443,
          "path": "/v1"
        }
      ],
      "controls": {
        "performance": {
          "description": "API Gateway rate limiting and caching requirements",
          "requirements": [
            {
              "requirement-url": "https://internal-policy.example.com/performance/rate-limiting",
              "config-url": "https://configs.example.com/gateway/rate-limits.yaml"
            },
            {
              "requirement-url": "https://internal-policy.example.com/performance/caching-policy",
              "config": {
                "default-ttl-seconds": 300,
                "cache-control": "private"
              }
            }
          ]
        }
      }
    },
    {
      "unique-id": "api-gateway-2",
      "node-type": "service",
      "name": "API Gateway 2",
      "description": "Central entry point for all client requests, providing routing, rate limiting, and request validation",
      "metadata": {
        "tech-owner": "Platform Team",
        "repository": "https://github.com/company/api-gateway",
        "deployment-type": "container",
        "sla-tier": "tier-1"
      },
      "interfaces": [
        {
          "unique-id": "api-gateway-2-https",
          "protocol": "HTTPS",
          "host": "api.ecommerce.example.com",
          "port": 443,
          "path": "/v1"
        }
      ],
      "controls": {
        "performance": {
          "description": "API Gateway rate limiting and caching requirements",
          "requirements": [
            {
              "requirement-url": "https://internal-policy.example.com/performance/rate-limiting",
              "config-url": "https://configs.example.com/gateway/rate-limits.yaml"
            },
            {
              "requirement-url": "https://internal-policy.example.com/performance/caching-policy",
              "config": {
                "default-ttl-seconds": 300,
                "cache-control": "private"
              }
            }
          ]
        }
      }
    },
    {
      "unique-id": "load-balancer",
      "node-type": "service",
      "name": "Load Balancer",
      "description": "Distributes traffic across API Gateway instances for high availability",
      "metadata": {
        "ha-enabled": true,
        "tech-owner": "Platform Team",
        "deployment-type": "container"
      },
      "interfaces": [
        {
          "unique-id": "load-balancer-https",
          "protocol": "HTTPS",
          "host": "api.ecommerce.example.com",
          "port": 443,
          "path": "/v1"
        }
      ]
    },
    {
      "unique-id": "order-service",
      "node-type": "service",
      "name": "Order Service",
      "description": "Manages order creation, fulfillment, and tracking",
      "metadata": {
        "tech-owner": "Order Team",
        "repository": "https://github.com/company/order-service",
        "deployment-type": "container",
        "sla-tier": "tier-1"
      },
      "interfaces": [
        {
          "unique-id": "order-service-api",
          "protocol": "HTTP",
          "host": "order-service.internal.example.com",
          "port": 8080,
          "path": "/api/orders"
        }
      ],
      "controls": {
        "circuit-breaker": {
          "description": "Circuit breaker configuration for failure isolation",
          "requirements": [
            {
              "requirement-url": "https://internal-policy.example.com/resilience/circuit-breaker-thresholds",
              "config": {
                "failure-threshold": 5,
                "recovery-timeout-seconds": 60,
                "success-threshold": 3
              }
            }
          ]
        }
      }
    },
    {
      "unique-id": "inventory-service",
      "node-type": "service",
      "name": "Inventory Service",
      "description": "Manages product inventory, stock levels, and availability",
      "metadata": {
        "tech-owner": "Inventory Team",
        "repository": "https://github.com/company/inventory-service",
        "deployment-type": "container",
        "sla-tier": "tier-1"
      },
      "interfaces": [
        {
          "unique-id": "inventory-service-api",
          "protocol": "HTTP",
          "host": "inventory-service.internal.example.com",
          "port": 8080,
          "path": "/api/inventory"
        }
      ]
    },
    {
      "unique-id": "payment-service",
      "node-type": "service",
      "name": "Payment Service",
      "description": "Handles payment processing, authorization, and settlement",
      "metadata": {
        "tech-owner": "Finance Team",
        "repository": "https://github.com/company/payment-service",
        "deployment-type": "container",
        "sla-tier": "tier-1"
      },
      "interfaces": [
        {
          "unique-id": "payment-service-api",
          "protocol": "HTTPS",
          "host": "payment-service.internal.example.com",
          "port": 8443,
          "path": "/api/payments"
        }
      ],
      "controls": {
        "compliance": {
          "description": "PCI-DSS compliance for payment processing",
          "requirements": [
            {
              "requirement-url": "https://www.pcisecuritystandards.org/documents/PCI-DSS-v4.0",
              "config-url": "https://configs.example.com/compliance/pci-dss-config.json"
            }
          ]
        }
      }
    },
    {
      "unique-id": "message-broker",
      "node-type": "system",
      "name": "Message Broker",
      "description": "RabbitMQ message broker for asynchronous processing",
      "metadata": {
        "engine": "RabbitMQ",
        "adr": "docs/adr/0001-use-message-queue-for-async-processing.md"
      },
      "interfaces": [
        {
          "unique-id": "message-broker-amqp",
          "protocol": "AMQP",
          "host": "rabbitmq.internal.example.com",
          "port": 5672
        }
      ]
    },
    {
      "unique-id": "order-queue",
      "node-type": "system",
      "name": "Order Queue",
      "description": "Message queue for order processing",
      "metadata": {
        "adr": "docs/adr/0001-use-message-queue-for-async-processing.md"
      },
      "interfaces": [
        {
          "unique-id": "order-queue-amqp",
          "protocol": "AMQP",
          "host": "rabbitmq.internal.example.com",
          "port": 5672,
          "queue": "orders"
        }
      ]
    },
    {
      "unique-id": "order-database-primary",
      "node-type": "database",
      "name": "Order Database Primary",
      "description": "Primary database for order data writes",
      "metadata": {
        "engine": "PostgreSQL",
        "tier": "primary",
        "backup": "daily",
        "role": "primary",
        "replication-mode": "async"
      },
      "interfaces": [
        {
          "unique-id": "order-database-primary-jdbc",
          "protocol": "JDBC",
          "host": "order-db-primary.example.com",
          "port": 5432,
          "database": "orders"
        }
      ]
    },
    {
      "unique-id": "order-database-replica",
      "node-type": "database",
      "name": "Order Database Replica",
      "description": "Replica database for order data reads",
      "metadata": {
        "engine": "PostgreSQL",
        "tier": "replica",
        "backup": "daily",
        "role": "replica",
        "replication-mode": "async"
      },
      "interfaces": [
        {
          "unique-id": "order-database-replica-jdbc",
          "protocol": "JDBC",
          "host": "order-db-replica.example.com",
          "port": 5432,
          "database": "orders"
        }
      ]
    },
    {
      "unique-id": "order-database-cluster",
      "node-type": "system",
      "name": "Order Database Cluster",
      "description": "Clustered order database with primary and replica for high availability",
      "controls": {
        "failover": {
          "description": "Database failover and recovery time objectives",
          "requirements": [
            {
              "requirement-url": "https://internal-policy.example.com/resilience/db-failover-rto-rpo",
              "config": {
                "rto-minutes": 5,
                "rpo-seconds": 30
              }
            }
          ]
        }
      }
    },
    {
      "unique-id": "inventory-database",
      "node-type": "database",
      "name": "Inventory Database",
      "description": "Stores product inventory, stock levels, and warehouse information",
      "metadata": {
        "engine": "PostgreSQL",
        "tier": "primary",
        "backup": "daily"
      },
      "interfaces": [
        {
          "unique-id": "inventory-database-jdbc",
          "protocol": "JDBC",
          "host": "inventory-db.example.com",
          "port": 5432,
          "database": "inventory"
        }
      ]
    },
    {
      "unique-id": "ecommerce-platform",
      "node-type": "system",
      "name": "E-Commerce Platform",
      "description": "Complete e-commerce platform comprising API gateway, microservices, and databases"
    }
  ],
  "relationships": [
    {
      "unique-id": "customer-interacts-load-balancer",
      "description": "Customer interacts with the e-commerce platform through the Load Balancer",
      "relationship-type": {
        "interacts": {
          "actor": "customer",
          "nodes": ["load-balancer"]
        }
      }
    },
    {
      "unique-id": "admin-interacts-load-balancer",
      "description": "Admin manages platform through the Load Balancer",
      "relationship-type": {
        "interacts": {
          "actor": "admin",
          "nodes": ["load-balancer"]
        }
      }
    },
    {
      "unique-id": "load-balancer-connects-api-gateway-1",
      "description": "Load Balancer distributes traffic to API Gateway 1",
      "relationship-type": {
        "connects": {
          "source": {
            "node": "load-balancer",
            "interfaces": ["load-balancer-https"]
          },
          "destination": {
            "node": "api-gateway-1",
            "interfaces": ["api-gateway-1-https"]
          }
        }
      },
      "protocol": "HTTP",
      "metadata": {
        "ha-enabled": true,
        "monitoring": true
      }
    },
    {
      "unique-id": "load-balancer-connects-api-gateway-2",
      "description": "Load Balancer distributes traffic to API Gateway 2",
      "relationship-type": {
        "connects": {
          "source": {
            "node": "load-balancer",
            "interfaces": ["load-balancer-https"]
          },
          "destination": {
            "node": "api-gateway-2",
            "interfaces": ["api-gateway-2-https"]
          }
        }
      },
      "protocol": "HTTP",
      "metadata": {
        "ha-enabled": true,
        "monitoring": true
      }
    },
    {
      "unique-id": "api-gateway-1-connects-order-service",
      "description": "API Gateway 1 routes order requests to the Order Service",
      "relationship-type": {
        "connects": {
          "source": {
            "node": "api-gateway-1",
            "interfaces": ["api-gateway-1-https"]
          },
          "destination": {
            "node": "order-service",
            "interfaces": ["order-service-api"]
          }
        }
      },
      "protocol": "HTTP",
      "metadata": {
        "latency-sla": "< 500ms",
        "monitoring": true,
        "circuit-breaker": true
      }
    },
    {
      "unique-id": "api-gateway-2-connects-order-service",
      "description": "API Gateway 2 routes order requests to the Order Service",
      "relationship-type": {
        "connects": {
          "source": {
            "node": "api-gateway-2",
            "interfaces": ["api-gateway-2-https"]
          },
          "destination": {
            "node": "order-service",
            "interfaces": ["order-service-api"]
          }
        }
      },
      "protocol": "HTTP",
      "metadata": {
        "latency-sla": "< 500ms",
        "monitoring": true,
        "circuit-breaker": true
      }
    },
    {
      "unique-id": "api-gateway-1-connects-inventory-service",
      "description": "API Gateway 1 routes inventory requests to the Inventory Service",
      "relationship-type": {
        "connects": {
          "source": {
            "node": "api-gateway-1",
            "interfaces": ["api-gateway-1-https"]
          },
          "destination": {
            "node": "inventory-service",
            "interfaces": ["inventory-service-api"]
          }
        }
      },
      "protocol": "HTTP",
      "metadata": {
        "latency-sla": "< 300ms",
        "monitoring": true,
        "circuit-breaker": true
      }
    },
    {
      "unique-id": "api-gateway-2-connects-inventory-service",
      "description": "API Gateway 2 routes inventory requests to the Inventory Service",
      "relationship-type": {
        "connects": {
          "source": {
            "node": "api-gateway-2",
            "interfaces": ["api-gateway-2-https"]
          },
          "destination": {
            "node": "inventory-service",
            "interfaces": ["inventory-service-api"]
          }
        }
      },
      "protocol": "HTTP",
      "metadata": {
        "latency-sla": "< 300ms",
        "monitoring": true,
        "circuit-breaker": true
      }
    },
    {
      "unique-id": "order-service-connects-order-database",
      "description": "Order Service writes order data to the primary Order Database",
      "relationship-type": {
        "connects": {
          "source": {
            "node": "order-service",
            "interfaces": ["order-service-api"]
          },
          "destination": {
            "node": "order-database-primary",
            "interfaces": ["order-database-primary-jdbc"]
          }
        }
      },
      "protocol": "JDBC",
      "metadata": {
        "latency-sla": "< 100ms",
        "monitoring": true,
        "circuit-breaker": false,
        "operation": "write"
      }
    },
    {
      "unique-id": "order-service-connects-order-database-replica",
      "description": "Order Service reads order data from the replica Order Database",
      "relationship-type": {
        "connects": {
          "source": {
            "node": "order-service",
            "interfaces": ["order-service-api"]
          },
          "destination": {
            "node": "order-database-replica",
            "interfaces": ["order-database-replica-jdbc"]
          }
        }
      },
      "protocol": "JDBC",
      "metadata": {
        "latency-sla": "< 100ms",
        "monitoring": true,
        "circuit-breaker": false,
        "operation": "read"
      }
    },
    {
      "unique-id": "order-service-publishes-order-queue",
      "description": "Order Service publishes order messages to the Order Queue",
      "relationship-type": {
        "connects": {
          "source": {
            "node": "order-service",
            "interfaces": ["order-service-api"]
          },
          "destination": {
            "node": "order-queue",
            "interfaces": ["order-queue-amqp"]
          }
        }
      },
      "protocol": "AMQP",
      "metadata": {
        "operation": "publish",
        "adr": "docs/adr/0001-use-message-queue-for-async-processing.md"
      }
    },
    {
      "unique-id": "payment-service-consumes-order-queue",
      "description": "Payment Service consumes order messages from the Order Queue",
      "relationship-type": {
        "connects": {
          "source": {
            "node": "payment-service",
            "interfaces": ["payment-service-api"]
          },
          "destination": {
            "node": "order-queue",
            "interfaces": ["order-queue-amqp"]
          }
        }
      },
      "protocol": "AMQP",
      "metadata": {
        "operation": "consume",
        "adr": "docs/adr/0001-use-message-queue-for-async-processing.md"
      }
    },
    {
      "unique-id": "inventory-service-connects-inventory-database",
      "description": "Inventory Service reads and writes inventory data to the Inventory Database",
      "relationship-type": {
        "connects": {
          "source": {
            "node": "inventory-service",
            "interfaces": ["inventory-service-api"]
          },
          "destination": {
            "node": "inventory-database",
            "interfaces": ["inventory-database-jdbc"]
          }
        }
      },
      "protocol": "JDBC",
      "metadata": {
        "latency-sla": "< 100ms",
        "monitoring": true,
        "circuit-breaker": false
      }
    },
    {
      "unique-id": "order-queue-composed-of-message-broker",
      "description": "Order Queue is composed of the Message Broker",
      "relationship-type": {
        "composed-of": {
          "container": "order-queue",
          "nodes": [
            "message-broker"
          ]
        }
      }
    },
    {
      "unique-id": "order-database-cluster-composed-of-databases",
      "description": "Order Database Cluster comprises primary and replica databases",
      "relationship-type": {
        "composed-of": {
          "container": "order-database-cluster",
          "nodes": [
            "order-database-primary",
            "order-database-replica"
          ]
        }
      }
    },
    {
      "unique-id": "ecommerce-platform-composed-of-services",
      "description": "E-Commerce Platform is composed of Load Balancer, API Gateways, microservices, and databases",
      "relationship-type": {
        "composed-of": {
          "container": "ecommerce-platform",
          "nodes": [
            "load-balancer",
            "api-gateway-1",
            "api-gateway-2",
            "order-service",
            "inventory-service",
            "payment-service",
            "message-broker",
            "order-queue",
            "order-database-cluster",
            "inventory-database"
          ]
        }
      }
    }
  ]
}